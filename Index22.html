<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>מוקאפ – טופס שאלה-במסך</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
  :root{
    color-scheme: dark;
    --bg:#0f0f11;
    --text:#fff;
    --muted:#a9abb1;
    --primary:#7c497b;
    --danger:#ff7b7b;
    --line:#383a40;
    --font:"Rubik",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }
  *{box-sizing:border-box}
  html,body{min-height:100dvh}
  body{
    margin:0; font-family:var(--font); color:var(--text);
    background:
      radial-gradient(70vw 70vh at 80% -10%, rgba(124,73,123,.28), transparent 60%),
      radial-gradient(70vw 70vh at 10% 110%, rgba(124,73,123,.18), transparent 36%),
      var(--bg);
  }

  /* Header (נשאר) */
  .wrap{max-width:1080px; margin:0 auto; padding:18px}
  .head{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:8px 2px 12px}
  .title{font-weight:700}
  .progress{display:flex; align-items:center; gap:10px; width:300px; max-width:50%}
  .bar{position:relative; height:7px; flex:1; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden}
  .bar > span{position:absolute; inset:0 100% 0 0; background:var(--primary); transition:all .25s ease}
  .count{font-weight:600; color:var(--muted); min-width:60px; text-align:center}

  /* זרימת מסכים בגלילה */
  .qflow{
    position: relative;
    height: 100dvh;
    max-height: 100svh;
    overflow-y: auto;
    scroll-snap-type: y mandatory;
    -webkit-overflow-scrolling: touch;
  }
  .q{
    min-height: 100dvh;
    scroll-snap-align: start;
    display:flex; align-items:center; justify-content:center;
    padding: 24px 18px;
  }

  /* ——— סגנון "המסך הראשון נשאר כמו שהוא" ——— */
  .q.classic .qbox{
    width:100%; max-width:760px;
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.18);
    border-radius:18px;
    padding:16px 16px 18px;
    box-shadow: 0 16px 40px rgba(0,0,0,.35), inset 0 1px 2px rgba(255,255,255,.12);
  }

  /* ——— סגנון Typeform למסכים 2+ ——— */
  .q.tf .stage{
    width: min(900px, 92vw);
  }
  .q.tf .ask{
    font-weight:700;
    line-height:1.35;
    font-size: clamp(22px, 3.2vw, 36px);
    text-align:center;
    margin: 0 0 30px;
  }
  .q.tf .fieldline{
    display:flex; align-items:center; gap:10px;
    border-bottom:1px solid #5a5a5a;
    padding: 10px 4px 14px;
  }
  .q.tf input[type="text"],
  .q.tf input[type="email"],
  .q.tf input[type="tel"],
  .q.tf textarea,
  .q.tf select{
    appearance:none; border:none; outline:none; background:transparent; color:var(--text);
    width:100%; font: inherit; font-size: clamp(18px, 2vw, 22px);
  }
  .q.tf input::placeholder,.q.tf textarea::placeholder{color:#bdbdbd}
  .q.tf .ok{
    flex: none;
    border:1px solid rgba(255,255,255,.22);
    background:rgba(255,255,255,.06);
    color:#fff; font-weight:700;
    padding:10px 16px; border-radius:10px; cursor:pointer;
  }
  .q.tf .ok:focus{outline:2px solid var(--primary); outline-offset:2px}
  .q.tf .meta{
    margin-top:10px; font-size:12px; color:var(--muted); text-align:center;
  }
  .q.tf .error{
    display:none; color:var(--danger); font-size:13px; margin-top:8px; text-align:center;
  }
  .q.tf.invalid .error{display:block}

  /* קלטים כלליים (למסך הראשון) */
  .label{font-weight:600; margin-bottom:8px}
  .req{color:var(--danger)}
  .hint{margin-top:8px; font-size:12px; color:var(--muted)}
  .field{display:flex; flex-direction:column; gap:8px}
  input,textarea,select,button{font:inherit; color:var(--text)}
  .classic input[type="text"], .classic input[type="email"], .classic input[type="tel"], .classic textarea, .classic select{
    appearance:none; width:100%;
    background: rgba(255,255,255,.06);
    border: 1px solid var(--line);
    border-radius:12px; padding:12px 12px; font-size:18px; outline:none;
  }
  .classic input:focus,.classic textarea:focus,.classic select:focus{
    border-color: var(--primary);
    background: rgba(255,255,255,.08);
  }
  .classic .error{display:none; color:var(--danger); font-size:13px}
  .classic .invalid .error{display:block}

  /* פוטר כפתורים נשאר */
  .footer{
    position: sticky; bottom:0; inset-inline:0;
    display:flex; justify-content:space-between; gap:10px;
    padding:12px 0;
    background: linear-gradient(180deg, transparent, rgba(0,0,0,.25));
    max-width:1080px; margin:0 auto;
  }
  .btn{border:none; cursor:pointer; padding:12px 16px; border-radius:12px; font-weight:700}
  .btn-primary{ background:var(--primary); color:#fff }
  .btn-ghost{ background:rgba(255,255,255,.08); color:#fff; border:1px solid rgba(255,255,255,.18) }

  @media (hover:none) and (pointer:coarse){
    html,body{ overscroll-behavior-y:none; }
  }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div class="title">שאלון דמו – שאלה אחת בכל מסך</div>
      <div class="progress">
        <div class="bar" aria-hidden="true"><span id="bar"></span></div>
        <b class="count" id="counter">1 / 5</b>
      </div>
    </div>
  </div>

  <!-- פאנלי השאלות -->
  <div class="qflow" id="qflow">
    <!-- Q1: נשאר כמו שהיה -->
    <section class="q classic">
      <div class="qbox">
        <div class="field" data-req>
          <div class="label">שם מלא <span class="req">*</span></div>
          <input type="text" name="full_name" placeholder="ישראל ישראלי">
          <div class="error">נא למלא שם</div>
        </div>
        <div class="field" data-req>
          <div class="label">אימייל <span class="req">*</span></div>
          <input type="email" name="email" placeholder="name@example.com">
          <div class="error">נא למלא אימייל תקין</div>
        </div>
        <div class="field" data-req>
          <div class="label">טלפון <span class="req">*</span></div>
          <input type="tel" name="phone" placeholder="050-234-5678" inputmode="tel">
          <div class="error">טלפון לא תקין</div>
        </div>
        <div class="hint">גלול/י קלות למטה כדי לעבור לשאלה הבאה • Enter גם עובד</div>
      </div>
    </section>

    <!-- Q2: סגנון Typeform -->
    <section class="q tf" data-req>
      <div class="stage">
        <h2 class="ask">איזה תחביב או פעילות גורמים לך להרגיש הכי מסופק/ת ומחובר/ת לעצמך?<br/>למה זה גורם לך להרגיש כך?</h2>
        <div class="fieldline">
          <input type="text" name="q2" placeholder="הקלד/י את התשובה כאן...">
          <button class="ok" type="button" data-next>אוקיי</button>
        </div>
        <div class="meta">ליצירת שורה חדשה החזק/י <b>Shift</b> + <b>Enter</b> • מעבר קדימה עם <b>Enter</b></div>
        <div class="error">נא למלא תשובה</div>
      </div>
    </section>

    <!-- Q3 -->
    <section class="q tf" data-req>
      <div class="stage">
        <h2 class="ask">מהי המטרה המרכזית שלך ל-3 החודשים הקרובים?</h2>
        <div class="fieldline">
          <input type="text" name="goal" placeholder="לדוגמה: להשיק אתר/לסגור 5 לקוחות ראשונים...">
          <button class="ok" type="button" data-next>אוקיי</button>
        </div>
        <div class="meta">אפשר לחזור למעלה עם גלילה קצרה למעלה</div>
        <div class="error">נא למלא מטרה</div>
      </div>
    </section>

    <!-- Q4 -->
    <section class="q tf" data-req>
      <div class="stage">
        <h2 class="ask">ספר/י בקצרה על המותג: מה הוא בא לפתור ולמי הוא פונה?</h2>
        <div class="fieldline">
          <input type="text" name="about" placeholder="טקסט חופשי...">
          <button class="ok" type="button" data-next>אוקיי</button>
        </div>
        <div class="meta">שורה חדשה: Shift+Enter</div>
        <div class="error">נא למלא</div>
      </div>
    </section>

    <!-- Q5 (סיום) -->
    <section class="q tf" data-req>
      <div class="stage">
        <h2 class="ask">אישור פרטים</h2>
        <div class="fieldline">
          <label style="display:flex;align-items:center;gap:10px;width:100%">
            <input type="checkbox" name="consent" style="width:18px;height:18px;accent-color:var(--primary)">
            מאשר/ת שהפרטים נכונים
          </label>
          <button class="ok" type="button" id="submitBtn">שליחה</button>
        </div>
        <div class="meta">אפשר גם Enter לשליחה</div>
        <div class="error">חובה לאשר</div>
      </div>
    </section>
  </div>

  <!-- פוטר ניווט כללי -->
  <div class="footer">
    <button class="btn btn-ghost" id="prevBtn" type="button">חזרה</button>
    <button class="btn btn-primary" id="nextBtn" type="button">המשך</button>
  </div>

<script>
const $ = (s, el=document)=> el.querySelector(s);
const $$ = (s, el=document)=> Array.from(el.querySelectorAll(s));
const flow = $('#qflow');
const panels = $$('.q', flow);
const bar = $('#bar');
const counter = $('#counter');

let activeIndex = 0;
let animating = false;

// ===== וולידציה (נשתמש רק בזמן "שליחה") =====
function validatePanel(idx){
  const q = panels[idx];
  if(!q) return true;

  if(q.classList.contains('tf')){
    const input = q.querySelector('input, textarea, select');
    const check = input && input.type === 'checkbox' ? input.checked : (input?.value||'').trim();
    const ok = !!check;
    q.classList.toggle('invalid', !ok);
    return ok;
  }

  // למסך הראשון (classic)
  let ok = true;
  $$('.field', q).forEach(box=>{
    const input = box.querySelector('input, textarea, select');
    if(!input) return;
    let v = input.type === 'checkbox' ? input.checked : (input.value||'').trim();
    if(input.type === 'email' && v){
      const re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if(!re.test(v)) { ok=false; box.classList.add('invalid'); }
      else box.classList.remove('invalid');
    }else if(input.name === 'phone' && v){
      const re=/^0\d{1,2}-?\d{7}$/;
      if(!re.test(v)) { ok=false; box.classList.add('invalid'); }
      else box.classList.remove('invalid');
    }else{
      if(!v){ ok=false; box.classList.add('invalid'); }
      else box.classList.remove('invalid');
    }
  });
  return ok;
}

// עדכון פס/מונה
function updateProgress(i){
  const total = panels.length;
  const p = i/(Math.max(total-1,1));
  bar.style.insetInlineEnd = `${100 - Math.round(p*100)}%`;
  counter.textContent = `${Math.min(i+1,total)} / ${total}`;
}

// ===== גלילה מונפשת (ללא חסימה על וולידציה) =====
function goTo(i){
  const target = Math.max(0, Math.min(i, panels.length-1));
  if(animating) return;

  const start = flow.scrollTop;
  const end = target * flow.clientHeight;
  const duration = 900; // שנה למהירות הרצויה
  const startTime = performance.now();
  animating = true;

  const prevSnap = flow.style.scrollSnapType;
  flow.style.scrollSnapType = 'none';

  function animate(now){
    const t = Math.min(1, (now - startTime) / duration);
    const ease = t<0.5 ? 2*t*t : -1+(4-2*t)*t; // easeInOutQuad
    flow.scrollTop = start + (end - start) * ease;
    if(t < 1){
      requestAnimationFrame(animate);
    }else{
      flow.scrollTop = end;
      flow.style.scrollSnapType = prevSnap || 'y mandatory';
      animating = false;
    }
  }
  requestAnimationFrame(animate);
}

// תצפית על פאנלים – עדכון אינדקס/פס ופוקוס
const io = new IntersectionObserver((entries)=>{
  entries.forEach(e=>{
    if(e.isIntersecting && e.intersectionRatio > 0.6){
      const i = panels.indexOf ? panels.indexOf(e.target) : Array.from(panels).indexOf(e.target);
      activeIndex = i;
      updateProgress(i);
      const inp = e.target.querySelector('input, textarea, select');
      if(inp) setTimeout(()=> inp.focus({preventScroll:true}), 40);
    }
  });
},{ root: flow, threshold:[0.6] });
panels.forEach(q=> io.observe(q));

// גלגלת – מניעת גלילה טבעית כדי שלא "תילחם" באנימציה
flow.addEventListener('wheel', (e)=>{
  e.preventDefault();
  if(animating) return;
  const dir = Math.sign(e.deltaY);
  if(dir > 0) goTo(activeIndex+1);
  else if(dir < 0) goTo(activeIndex-1);
}, {passive:false});

// מקשים
flow.addEventListener('keydown', (e)=>{
  const tag = (e.target.tagName||'').toLowerCase();
  const isTextarea = tag === 'textarea';
  if(e.key === 'Enter' && !e.shiftKey && !isTextarea){
    e.preventDefault(); goTo(activeIndex+1);
  }else if(e.key === 'PageDown' || e.key === 'ArrowDown'){
    e.preventDefault(); goTo(activeIndex+1);
  }else if(e.key === 'PageUp' || e.key === 'ArrowUp'){
    e.preventDefault(); goTo(activeIndex-1);
  }
});

// כפתורים
$('#prevBtn').addEventListener('click', ()=> goTo(activeIndex-1));
$('#nextBtn').addEventListener('click', ()=> goTo(activeIndex+1));
$$('[data-next]').forEach(btn=> btn.addEventListener('click', ()=> goTo(activeIndex+1)));

// ===== שליחה: בודקים את כל הפאנלים ורק אז שולחים =====
$('#submitBtn').addEventListener('click', ()=>{
  let allOk = true;
  for(let i=0;i<panels.length;i++){
    if(!validatePanel(i)) allOk = false;
  }
  if(!allOk){
    alert('יש שדות שחייבים למלא לפני שליחה.');
    return;
  }

  const data = {};
  $$('#qflow input, #qflow textarea, #qflow select').forEach(inp=>{
    const key = inp.name || '';
    if(!key) return;
    data[key] = inp.type === 'checkbox' ? inp.checked : inp.value;
  });
  console.log('Submitting payload:', data);
  alert('נשלח! (בדמו זה רק console.log)');
  goTo(0);
});

// אתחול
updateProgress(0);
const first = panels[0]?.querySelector('input, textarea, select');
if(first) first.focus({preventScroll:true});
</script>


</body>
</html>
